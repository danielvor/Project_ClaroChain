(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))s(t);new MutationObserver(t=>{for(const i of t)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function n(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerPolicy&&(i.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?i.credentials="include":t.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(t){if(t.ep)return;t.ep=!0;const i=n(t);fetch(t.href,i)}})();/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */class B{constructor(){this.chain=[this.createGenesisBlock()]}createGenesisBlock(){const e=Date.now(),n=0,s="Genesis Block",t="0",i=this.calculateHash(n,t,e,s);return{index:n,timestamp:e,data:s,previousHash:t,hash:i}}getLatestBlock(){return this.chain[this.chain.length-1]}calculateHash(e,n,s,t){const i=typeof t=="string"?t:JSON.stringify(t),a=`${e}${n}${s}${i}`;let r=0;for(let d=0;d<a.length;d++){const D=a.charCodeAt(d);r=(r<<5)-r+D,r|=0}return Math.abs(r).toString(16).padStart(8,"0")}addBlock(e){const n=this.getLatestBlock(),s=n.index+1,t=Date.now(),i=this.calculateHash(s,n.hash,t,e),a={index:s,timestamp:t,data:e,previousHash:n.hash,hash:i};return this.chain.push(a),a}}const g=new B,l=new Map;let m="clientsList",p=null;const c=document.getElementById("data-display-container"),f=document.getElementById("visit-form"),u=document.getElementById("clientName"),v=document.getElementById("visitDate"),C=document.getElementById("technicianName"),L=document.getElementById("description");function y(o,e,n){var i,a;const{clientName:s}=o,t={originalVisitData:o,blockTimestamp:e,blockIndex:n};l.has(s)?((i=l.get(s))==null||i.push(t),(a=l.get(s))==null||a.sort((r,d)=>d.blockTimestamp-r.blockTimestamp)):l.set(s,[t])}function b(){if(!c)return;if(c.innerHTML="",l.size===0){const e=document.createElement("p");e.textContent="Nenhum cliente registrado ainda. Adicione uma visita técnica para começar.",e.classList.add("no-data-message"),c.appendChild(e);return}Array.from(l.keys()).sort((e,n)=>e.localeCompare(n)).forEach(e=>{const n=document.createElement("button");n.classList.add("client-list-item"),n.textContent=e,n.setAttribute("aria-label",`Ver visitas de ${e}`),n.onclick=()=>{p=e,m="clientVisits",h()},c.appendChild(n)})}function E(o){if(!c)return;c.innerHTML="";const e=document.createElement("button");e.classList.add("back-button"),e.textContent="← Voltar para Lista de Clientes",e.setAttribute("aria-label","Voltar para a lista de clientes"),e.onclick=()=>{p=null,m="clientsList",h()},c.appendChild(e);const n=document.createElement("h3");n.classList.add("client-visits-heading"),n.textContent=`Visitas de: ${o}`,c.appendChild(n);const s=l.get(o);if(!s||s.length===0){const t=document.createElement("p");t.textContent="Nenhuma visita registrada para este cliente.",t.classList.add("no-data-message"),c.appendChild(t);return}s.forEach(t=>{const i=document.createElement("div");i.classList.add("visit-entry"),i.setAttribute("role","listitem");const a=t.originalVisitData,r=new Date(a.visitDate+"T00:00:00");i.innerHTML=`
            <p><strong>Registrado em (Timestamp):</strong> ${new Date(t.blockTimestamp).toLocaleString("pt-BR")}</p>
            <p><strong>Bloco Referência:</strong> #${t.blockIndex}</p>
            <div class="visit-data-details">
                <p><strong>Data da Visita:</strong> ${r.toLocaleDateString("pt-BR",{timeZone:"UTC"})}</p> <!-- UTC to avoid timezone shifts from picker value -->
                <p><strong>Técnico:</strong> ${a.technicianName}</p>
                <p><strong>Descrição:</strong> ${a.description.replace(/\n/g,"<br>")}</p>
            </div>
        `,c.appendChild(i)})}function h(){c&&(c.innerHTML="",m==="clientsList"?b():m==="clientVisits"&&p&&E(p),c.scrollTop=0)}f.addEventListener("submit",o=>{o.preventDefault();const e={clientName:u.value.trim(),visitDate:v.value,technicianName:C.value.trim(),description:L.value.trim()};if(!e.clientName||!e.visitDate||!e.technicianName){alert("Por favor, preencha todos os campos obrigatórios: Nome do Cliente, Data da Visita e Nome do Técnico.");return}const n=g.addBlock(e);y(e,n.timestamp,n.index),h(),f.reset(),u.focus()});function N(){g.chain.forEach(o=>{typeof o.data!="string"&&y(o.data,o.timestamp,o.index)}),h(),u&&u.focus()}document.addEventListener("DOMContentLoaded",()=>{c&&f&&u&&v&&C&&L?N():console.error("Um ou mais elementos DOM necessários não foram encontrados para inicializar a aplicação.")});typeof process>"u"&&(window.process={env:{}});
